


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > ScamCaseDaoImpl</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.example.antiscam.dataclass</a>
</div>

<h1>Coverage Summary for Class: ScamCaseDaoImpl (com.example.antiscam.dataclass)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ScamCaseDaoImpl</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/11)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/30)
  </span>
</td>
</tr>
  <tr>
    <td class="name">ScamCaseDaoImpl$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">ScamCaseDaoImpl$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">ScamCaseDaoImpl$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/11)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">ScamCaseDaoImpl$4</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/19)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/67)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.example.antiscam.dataclass;
&nbsp;
&nbsp;import android.util.Log;
&nbsp;
&nbsp;import androidx.annotation.NonNull;
&nbsp;
&nbsp;import com.example.antiscam.bean.ScamCase;
&nbsp;import com.example.antiscam.core.TokenHelper;
&nbsp;import com.example.antiscam.core.Tokenizer;
&nbsp;import com.example.antiscam.singleton.FirestoreSingleton;
&nbsp;import com.google.android.gms.tasks.OnCompleteListener;
&nbsp;import com.google.android.gms.tasks.Task;
&nbsp;import com.google.firebase.firestore.CollectionReference;
&nbsp;import com.google.firebase.firestore.DocumentReference;
&nbsp;import com.google.firebase.firestore.DocumentSnapshot;
&nbsp;import com.google.firebase.firestore.FieldValue;
&nbsp;import com.google.firebase.firestore.FirebaseFirestore;
&nbsp;import com.google.firebase.firestore.Query;
&nbsp;import com.google.firebase.firestore.QueryDocumentSnapshot;
&nbsp;import com.google.firebase.firestore.QuerySnapshot;
&nbsp;import com.google.gson.Gson;
&nbsp;
&nbsp;import java.util.LinkedList;
&nbsp;
&nbsp;public class ScamCaseDaoImpl implements ScamCaseDao {
<b class="nc">&nbsp;    private FirebaseFirestore db = FirebaseFirestore.getInstance();;</b>
&nbsp;    private static ScamCaseDaoImpl scamCaseDao;
<b class="nc">&nbsp;    private CollectionReference casesCollection = db.collection(&quot;scam_cases&quot;);</b>
<b class="nc">&nbsp;    private CollectionReference counter = db.collection(&quot;counter&quot;);</b>
<b class="nc">&nbsp;    DocumentReference nextIdDocument = counter.document(&quot;caseID&quot;);</b>
&nbsp;
&nbsp;    private static final String TAG = &quot;ScamCaseDaoImpl&quot;;
&nbsp;
<b class="nc">&nbsp;    private ScamCaseDaoImpl() {</b>
&nbsp;    }
&nbsp;
&nbsp;    public static ScamCaseDaoImpl getInstance() {
<b class="nc">&nbsp;        if (scamCaseDao == null) {</b>
<b class="nc">&nbsp;            scamCaseDao = new ScamCaseDaoImpl();</b>
&nbsp;        }
<b class="nc">&nbsp;        return scamCaseDao;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void getAllScamCase(ScamCaseCallback scamCaseCallback) {
<b class="nc">&nbsp;        casesCollection.orderBy(&quot;post_date&quot;, Query.Direction.DESCENDING).limit(100).get()</b>
&nbsp;//        usersCollection.limit(100).get()
<b class="nc">&nbsp;                .addOnCompleteListener(new OnCompleteListener&lt;QuerySnapshot&gt;() {</b>
&nbsp;                    @Override
&nbsp;                    public void onComplete(@NonNull Task&lt;QuerySnapshot&gt; task) {
<b class="nc">&nbsp;                        if (task.isSuccessful()) {</b>
<b class="nc">&nbsp;                            for (QueryDocumentSnapshot document : task.getResult()) {</b>
&nbsp;//                                Log.d(TAG, document.getId() + &quot; =&gt; &quot; + document.getData().get(&quot;post_user&quot;));
&nbsp;                                // get document data
<b class="nc">&nbsp;                                ScamCase scamCase = document.toObject(ScamCase.class);</b>
&nbsp;                                // pass user class to callback function
<b class="nc">&nbsp;                                scamCaseCallback.onScamCaseReceived(scamCase);</b>
<b class="nc">&nbsp;                            }</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            Log.d(TAG, &quot;Error getting documents: &quot;, task.getException());</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                });
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void getAllScamCases(Tokenizer tokenizer, ScamCasesCallback scamCasesCallback) {
<b class="nc">&nbsp;        Query query = TokenHelper.getInstance().genQuery(casesCollection, tokenizer);</b>
<b class="nc">&nbsp;        query.limit(100).get()</b>
<b class="nc">&nbsp;                .addOnCompleteListener(new OnCompleteListener&lt;QuerySnapshot&gt;() {</b>
&nbsp;                    @Override
&nbsp;                    public void onComplete(@NonNull Task&lt;QuerySnapshot&gt; task) {
<b class="nc">&nbsp;                        if (task.isSuccessful()) {</b>
<b class="nc">&nbsp;                            LinkedList&lt;ScamCase&gt; scamCases = new LinkedList&lt;&gt;();</b>
<b class="nc">&nbsp;                            for (QueryDocumentSnapshot document : task.getResult()) {</b>
<b class="nc">&nbsp;                                ScamCase scamCase = document.toObject(ScamCase.class);</b>
<b class="nc">&nbsp;                                scamCases.add(scamCase);</b>
<b class="nc">&nbsp;                            }</b>
<b class="nc">&nbsp;                            scamCasesCallback.onScamCaseReceived(scamCases);</b>
<b class="nc">&nbsp;                        } else {</b>
<b class="nc">&nbsp;                            Log.d(TAG, &quot;Error getting documents: &quot;, task.getException());</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                });
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Add data to Firestore database
&nbsp;     * @param scamcase:
&nbsp;     */
&nbsp;
&nbsp;    @Override
&nbsp;    public void addScamCase(ScamCase scamcase) {
<b class="nc">&nbsp;        casesCollection</b>
<b class="nc">&nbsp;                .add(scamcase)</b>
<b class="nc">&nbsp;                .addOnCompleteListener(task -&gt; {</b>
<b class="nc">&nbsp;                    if (task.isSuccessful()) {</b>
<b class="nc">&nbsp;                        Log.d(TAG, &quot;ScamCase added successfully&quot;);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        Log.e(TAG, &quot;Error adding ScamCase&quot;, task.getException());</b>
&nbsp;                    }
&nbsp;                });
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * find the field called nextID
&nbsp;     * @param callback: is a interface
&nbsp;     */
&nbsp;
&nbsp;    public void getNextId(NextIdCallback callback) {
<b class="nc">&nbsp;        nextIdDocument.get().addOnCompleteListener(new OnCompleteListener&lt;DocumentSnapshot&gt;() {</b>
&nbsp;            @Override
&nbsp;            public void onComplete(@NonNull Task&lt;DocumentSnapshot&gt; task) {
<b class="nc">&nbsp;                if (task.isSuccessful()) {</b>
<b class="nc">&nbsp;                    DocumentSnapshot document = task.getResult();</b>
<b class="nc">&nbsp;                    if (document.exists()) {</b>
&nbsp;                        // Get the value of the &quot;nextID&quot; field as an integer
<b class="nc">&nbsp;                        int nextId = document.getLong(&quot;nextID&quot;).intValue();</b>
<b class="nc">&nbsp;                        Log.d(TAG, &quot;Next ID: &quot; + nextId);</b>
&nbsp;                        // Pass the result back to the caller using the callback
&nbsp;                        //onNextId method will be implemented when calling scamCaseDaoImpl.getNextId
<b class="nc">&nbsp;                        callback.onNextId(nextId);</b>
<b class="nc">&nbsp;                    } else {</b>
<b class="nc">&nbsp;                        Log.d(TAG, &quot;do not find nextId&quot;);</b>
&nbsp;                    }
<b class="nc">&nbsp;                } else {</b>
<b class="nc">&nbsp;                    Log.e(TAG, &quot;Error getting document&quot;, task.getException());</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * nextID plus 1 when customer add a new post
&nbsp;     * @param callback: interface use to call other method
&nbsp;     */
&nbsp;    @Override
&nbsp;    public void updateNextId(NextIdCallback callback) {
<b class="nc">&nbsp;        nextIdDocument.update(&quot;nextID&quot;, FieldValue.increment(1))</b>
<b class="nc">&nbsp;                .addOnSuccessListener(aVoid -&gt; {</b>
<b class="nc">&nbsp;                    Log.d(TAG, &quot;Next ID incremented successfully&quot;);</b>
&nbsp;                    // Fetch the updated nextID value and pass it to the callback
<b class="nc">&nbsp;                    getNextId(callback);</b>
&nbsp;                })
<b class="nc">&nbsp;                .addOnFailureListener(e -&gt; {</b>
<b class="nc">&nbsp;                    Log.e(TAG, &quot;Error incrementing nextID&quot;, e);</b>
&nbsp;                });
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void getDocumentId(int scam_id, OnDocumentIdCallback callback) {
<b class="nc">&nbsp;        casesCollection</b>
<b class="nc">&nbsp;                .whereEqualTo(&quot;scam_id&quot;, scam_id)</b>
<b class="nc">&nbsp;                .get()</b>
<b class="nc">&nbsp;                .addOnCompleteListener(new OnCompleteListener&lt;QuerySnapshot&gt;() {</b>
&nbsp;                    @Override
&nbsp;                    public void onComplete(@NonNull Task&lt;QuerySnapshot&gt; task) {
<b class="nc">&nbsp;                        if (task.isSuccessful()) {</b>
<b class="nc">&nbsp;                            for (QueryDocumentSnapshot document : task.getResult()) {</b>
<b class="nc">&nbsp;                                String documentId = document.getId();</b>
<b class="nc">&nbsp;                                if (!documentId.isEmpty()) {</b>
<b class="nc">&nbsp;                                    callback.onDocumentIdReceived(documentId);</b>
&nbsp;                                    return; // Exit the loop if a valid documentId is found.
&nbsp;                                }
<b class="nc">&nbsp;                            }</b>
<b class="nc">&nbsp;                            callback.onDocumentIdNotFound(); // Handle the case where no matching document is found.</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            Log.d(TAG, &quot;Get DocumentId Failed&quot;);</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                });
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-10-18 16:55</div>
</div>
</body>
</html>
